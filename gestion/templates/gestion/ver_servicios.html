{% extends "gestion/base.html" %}
{% load static %}

{% block title %}Servicios de Obra{% endblock %}

{% block content %}
<h2>Servicios registrados en la obra: {{ obra.nombre }}</h2>
<a href="{% url 'agregar_servicio' obra.id %}" class="btn btn-success mb-3">Agregar Servicio</a>

<table class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>OTVM</th>
            <th>Fecha</th>
            <th>Trabajo Realizado</th>
            <th>Cantidad</th>
            <th>Solicitante</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for servicio in servicios %}
        <tr>
            <td>{{ servicio.otvm }}</td>
            <td>{{ servicio.fecha }}</td>
            <td>{{ servicio.trabajo_realizado.nombre }}</td>
            <td>{{ servicio.cantidad }}</td>
            <td>{{ servicio.solicitante }}</td>
            <td>
                <a href="{% url 'detalle_servicio' servicio.id %}" class="btn btn-sm btn-info">Ver</a>
                <a href="{% url 'modificar_servicio' servicio.id %}" class="btn btn-sm btn-warning">Modificar</a>
                
                   <!-- Botón que abre el modal -->
                        <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal"
                                data-bs-target="#modalEliminar{{ servicio.id }}">
                            Eliminar
                        </button>

                        <!-- Modal de confirmación -->
                        <div class="modal fade" id="modalEliminar{{ servicio.id }}" tabindex="-1" aria-labelledby="modalLabel{{ servicio.id }}" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="modalLabel{{ servicio.id }}">Confirmar eliminación</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                            </div>
                            <div class="modal-body">
                                ¿Estás seguro de eliminar el servicio <strong>{{ servicio.trabajo_realizado.nombre }}</strong>?
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                <form method="POST" action="{% url 'eliminar_servicio' servicio.id %}" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger">Sí, eliminar</button>
                                </form>
                            </div>
                            </div>
                        </div>
                        </div>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6">No hay servicios registrados aún.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<a href="{% url 'ver_obras' obra.cliente.id %}" class="btn btn-secondary mt-2">Volver a Obras</a>
{% endblock %}
